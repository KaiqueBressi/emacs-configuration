workflow "BPMN Image" {
  on = "pull_request"
  resolves = ["Filter Pull Request", "Generate Images", "Upload Images", "Comment on Github"]
}

action "Filter Pull Request" {
  uses = "actions/bin/filter@master"
  args = "action 'opened|synchronize'"
}

action "Generate Images" {
  needs = ["Filter Pull Request"]
  uses = "./generate-bpmn-images"
}

action "Upload Images" {
  needs = ["Generate Images"]
  uses = "actions/aws/cli@efb074ae4510f2d12c7801e4461b65bf5e8317e6"
  secrets = ["AWS_ACCESS_KEY_ID", "AWS_SECRET_ACCESS_KEY"]
  args = "s3 cp --recursive --acl public-read bpmn-images/ s3://creditas-dev-public-attachments/"
}

action "Comment on Github" {
  needs = ["Upload Images"]
  uses = "./comment-on-github"
  secrets = ["GITHUB_TOKEN"]
}



name: BPMN Image

on: [pull_request]

jobs:
  post_image:
    runs-on: ubuntu-18.04
    name: Post Image
    steps:
      - name: Generate Images
        uses: ./.github/actions/build

      - name: Upload Images
        uses: actions/aws/cli@master
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        with:
          args: s3 cp --recursive --acl public-read bpmn-images/ s3://creditas-dev-public-attachments/
