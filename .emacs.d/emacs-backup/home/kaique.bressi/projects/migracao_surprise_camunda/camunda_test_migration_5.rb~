require 'logger'
require 'json'
require 'concurrent'
require 'httparty'

class Camunda
  include HTTParty

  logger ::Logger.new($stdout)

  base_uri 'https://camunda.journey.prod.creditas.io/'
  headers 'Authorization' => "Bearer #{ENV.fetch('TOKEN')}", 'Content-Type' => 'application/json'
end

def modify_variable_body(operation_profile)
  JSON.dump(
    {
      "modifications" => {
        "operation_profile" => {
          "value" => operation_profile,
          "type" => "String"
        }
      }
    }
  )
end

DMN_KEY = "ProfileRatingTable"

variables = Camunda.get("/engine-rest/process-instance/f9f06aef-969f-11e9-9070-0242ac110003/variables")
dmn_variables = { variables: variables.parsed_response }

require 'pry-byebug'; byebug;

puts variables

response = Camunda.post("/engine-rest/decision-definition/key/#{DMN_KEY}/evaluate", body: JSON.dump(dmn_variables))
puts response
